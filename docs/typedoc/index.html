<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>robokit-cognitive-hub</title><meta name="description" content="Documentation for robokit-cognitive-hub"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">robokit-cognitive-hub</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1> robokit-cognitive-hub </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#robokit-cognitive-hub" id="robokit-cognitive-hub" style="color: inherit; text-decoration: none;">
  <h1>robokit-cognitive-hub</h1>
</a>
<p><img src="./docs/media/robokit-logo.png" alt="robokit-logo"></p>
<p>robokit-cognitive-hub serves as a cloud endpoint for conversational ai devices, i.e. robots.</p>
<p>robokit-cognitive-hub is a lightweight microservice with the essential features needed to develop robust voice-driven applications. </p>
<p>Features include:</p>
<ul>
<li>Express route handling</li>
<li>GET/POST REST api routes</li>
<li>HTTP admin UI pages</li>
<li>JWT auth (example mock implementation)</li>
<li>docker support</li>
<li>Socket.io connectivity for Devices, Controllers and Apps</li>
<li>WebSocket api routes (optional)</li>
<li>Clock sync between the service and connected devices - enabling syncronized, multi-device/robot applications (i.e. show control)</li>
<li>Audio streaming/routing to ASR/STT services with real time event handling (SoS, EoS, incremental results) - i.e. Azure Speech/STT</li>
<li>Event routing to/from NLU services - i.e. Azure LUIS &amp; CLU</li>
<li>Audio streaming from TTS services - i.e. Azure Custom Voice</li>
<li>Routing of events to/from Skill/Application microservices</li>
<li>Remote control of Devices by Contoller clients - i.e. human-in-the-loop Woz (Wizard of Oz) Controllers</li>
<li>Routing of events to/from external App clients for integration with existing applications - i.e. realtime integration with game services</li>
</ul>

<a href="#medium-article" id="medium-article" style="color: inherit; text-decoration: none;">
  <h3>medium article</h3>
</a>
<p>TBD</p>
<p>For details about the project structure, see: <a href="https://medium.com/@andrew.rapo/a-nodejs-microservice-template-36f080fe1418">A Nodejs Microservice Template</a></p>

<a href="#cloud-architecture" id="cloud-architecture" style="color: inherit; text-decoration: none;">
  <h3>cloud architecture</h3>
</a>
<p><img src="./docs/media/robokit-cloud-architecture-simple.png" alt="robokit-cognitive-hub architecture"></p>

<a href="#install" id="install" style="color: inherit; text-decoration: none;">
  <h3>install</h3>
</a>
<p><code>npm install</code></p>

<a href="#build" id="build" style="color: inherit; text-decoration: none;">
  <h3>build</h3>
</a>
<ul>
<li>checkout the <a href="https://github.com/wwlib/robokit-hub-controller">robokit-hub-controller</a> module (react app) so it is a peer of robokit-cognitive-hub</li>
<li>build the robokit-hub-controller module</li>
<li>then:</li>
</ul>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1"> </span><span class="hl-0">copy</span><span class="hl-1">-</span><span class="hl-0">hub</span><span class="hl-1">-</span><span class="hl-0">controller</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1"> </span><span class="hl-0">build</span>
</code></pre>

<a href="#module-dependencies" id="module-dependencies" style="color: inherit; text-decoration: none;">
  <h3>module dependencies</h3>
</a>
<ul>
<li>checkout, build &amp; start the <a href="https://github.com/wwlib/robokit-cloud-skill">robokit-cloud-skill</a> project</li>
<li>checkout, build &amp; start the <a href="https://github.com/wwlib/lima-service">lima-service</a> project</li>
</ul>

<a href="#run" id="run" style="color: inherit; text-decoration: none;">
  <h3>run</h3>
</a>
<p><code>npm run start</code></p>

<a href="#docs" id="docs" style="color: inherit; text-decoration: none;">
  <h3>docs</h3>
</a>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1"> </span><span class="hl-2">docs</span><span class="hl-1">:</span><span class="hl-0">serve</span><br/><br/><span class="hl-1">(</span><span class="hl-0">when</span><span class="hl-1"> </span><span class="hl-0">code</span><span class="hl-1"> </span><span class="hl-0">changes</span><span class="hl-1">)</span><br/><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1"> </span><span class="hl-2">docs</span><span class="hl-1">:</span><span class="hl-0">build</span>
</code></pre>

<a href="#docker" id="docker" style="color: inherit; text-decoration: none;">
  <h3>docker</h3>
</a>
<p><code>docker build -t robokit-cognitive-hub .</code> </p>
<ul>
<li>or <code>npm run docker:build</code></li>
</ul>
<p>Copy <code>.env-example</code> to <code>.env</code></p>
<pre><code><span class="hl-3">SERVER_PORT</span><span class="hl-1">=</span><span class="hl-4">8082</span><br/><span class="hl-3">USE_AUTH</span><span class="hl-1">=</span><span class="hl-5">true</span><br/><span class="hl-3">AZURE_SPEECH_SUBSCRIPTION_KEY</span><span class="hl-1">=&lt;</span><span class="hl-6">YOUR</span><span class="hl-1">-</span><span class="hl-6">SUBSCRIPTION</span><span class="hl-1">-</span><span class="hl-6">KEY</span><span class="hl-1">&gt;</span><br/><span class="hl-3">AZURE_SPEECH_TOKEN_ENDPOINT</span><span class="hl-1">=</span><span class="hl-2">https</span><span class="hl-1">:</span><span class="hl-7">//azurespeechserviceeast.cognitiveservices.azure.com/sts/v1.0/issuetoken</span><br/><span class="hl-3">AZURE_SPEECH_REGION</span><span class="hl-1">=</span><span class="hl-0">eastus</span>
</code></pre>
<p><code>docker run -it --rm -p 8082:8082 --env-file ./.env robokit-cognitive-hub</code> </p>
<ul>
<li>or <code>npm run docker:run</code></li>
</ul>

<a href="#docker-compose" id="docker-compose" style="color: inherit; text-decoration: none;">
  <h3>docker compose</h3>
</a>
<ul>
<li>copy the files from docs/docker to a new directory</li>
<li>add your AZURE_SPEECH_SUBSCRIPTION_KEY to hub.env</li>
<li>add your LUIS_endpoint and LUIS_subscriptionKey to lima.env</li>
<li>then:</li>
</ul>
<pre><code><span class="hl-0">docker</span><span class="hl-1"> </span><span class="hl-0">compose</span><span class="hl-1"> </span><span class="hl-0">up</span><span class="hl-1"> -</span><span class="hl-0">d</span>
</code></pre>

<a href="#curl" id="curl" style="color: inherit; text-decoration: none;">
  <h3>curl</h3>
</a>
<p>Example auth request:</p>
<pre><code class="language-sh"><span class="hl-1">curl --location --request POST </span><span class="hl-8">&#39;http://localhost:8082/auth&#39;</span><span class="hl-1"> \</span><br/><span class="hl-1">     --header </span><span class="hl-8">&#39;Content-Type: application/json&#39;</span><span class="hl-1"> \</span><br/><span class="hl-1">     --data-raw </span><span class="hl-8">&#39;{</span><br/><span class="hl-8">       &quot;accountId&quot;: &quot;robot1&quot;,</span><br/><span class="hl-8">       &quot;password&quot;: &quot;12345!&quot;</span><br/><span class="hl-8">     }&#39;</span>
</code></pre>
<pre><code class="language-json"><span class="hl-1">{</span><span class="hl-9">&quot;message&quot;</span><span class="hl-1">:</span><span class="hl-8">&quot;Logged in successfully.&quot;</span><span class="hl-1">,</span><span class="hl-9">&quot;access_token&quot;</span><span class="hl-1">:</span><span class="hl-8">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2NvdW50SWQiOiJyb2JvdDEiLCJhdXRoIjp7InBlcm1pc3Npb25zIjpbeyJzY29wZXMiOlsicmVhZCIsImFkbWluIl0sInJlc291cmNlIjoiZXhhbXBsZSJ9XX0sImlhdCI6MTY1NjgxODY3MSwiZXhwIjoxNjU2ODE4NzMxfQ.TB_UUwFkc0fQLYi1q80hedBMvR7h4EIHzTSIoVTKOeA&quot;</span><span class="hl-1">,</span><span class="hl-9">&quot;refresh_token&quot;</span><span class="hl-1">:</span><span class="hl-8">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2NvdW50SWQiOiJyb2JvdDEiLCJpYXQiOjE2NTY4MTg2NzEsImV4cCI6MTY1NjkwNTA3MX0.VDMlgUPiP-0r9EJ4_Q93gqufPBCmqIYXQ5PCr9UsJ8s&quot;</span><span class="hl-1">,</span><span class="hl-9">&quot;account_id&quot;</span><span class="hl-1">:</span><span class="hl-8">&quot;robot1&quot;</span><span class="hl-1">}</span>
</code></pre>

<a href="#http---example-controller-app" id="http---example-controller-app" style="color: inherit; text-decoration: none;">
  <h3>http - example Controller app</h3>
</a>
<p><a href="http://localhost:8082">http://localhost:8082</a></p>

<a href="#http---example-dashboard" id="http---example-dashboard" style="color: inherit; text-decoration: none;">
  <h3>http - example dashboard</h3>
</a>
<p><a href="http://localhost:8082/dashboard">http://localhost:8082/dashboard</a></p>

<a href="#http---example-console" id="http---example-console" style="color: inherit; text-decoration: none;">
  <h3>http - example console</h3>
</a>
<p><a href="http://localhost:8082/console">http://localhost:8082/console</a></p>

<a href="#testing-the-cognitive-hub-service" id="testing-the-cognitive-hub-service" style="color: inherit; text-decoration: none;">
  <h3>testing the cognitive hub service</h3>
</a>
<ul>
<li>verify that the service is running by opening the hub Controller app at: <a href="http://localhost:8082">http://localhost:8082</a></li>
<li>verify that the ASR service working using the cli test app: <code>socket-cli-device.js</code> (see below)</li>
<li>checkout, build &amp; start the <a href="https://github.com/wwlib/cognitive-services-test-app">cognitive-services-test-app</a> project</li>
<li>use the <code>cognitive-services-test-app</code> as a &quot;robot&quot; client to test the cognitive hub</li>
</ul>

<a href="#cli-socket-validation-client-repl" id="cli-socket-validation-client-repl" style="color: inherit; text-decoration: none;">
  <h3>cli socket validation client (REPL)</h3>
</a>
<p>Used to test and validate the server.</p>
<pre><code><span class="hl-0">cd</span><span class="hl-1"> </span><span class="hl-0">tools</span><br/><span class="hl-0">node</span><span class="hl-1"> </span><span class="hl-0">socket</span><span class="hl-1">-</span><span class="hl-0">cli</span><span class="hl-1">-</span><span class="hl-0">device</span><span class="hl-1">.</span><span class="hl-0">js</span>
</code></pre>
<p>Note: The socket client will authenticate using the credentials in the <code>tools/.env</code> file.</p>
<p>This will start a cli/REPL that will accept and echo prompts.</p>
<pre><code><span class="hl-0">client</span><span class="hl-1"> </span><span class="hl-0">connected</span><br/><span class="hl-0">ctrl</span><span class="hl-1">-</span><span class="hl-0">c</span><span class="hl-1"> </span><span class="hl-0">to</span><span class="hl-1"> </span><span class="hl-0">quit</span><br/><span class="hl-1">&gt; </span><span class="hl-0">hello</span><br/><span class="hl-0">hello</span>
</code></pre>
<p>Anything typed at the <code>&gt;</code> prompt will be echoed.</p>
<p>Typing <code>asr</code> will stream the contents of <code>do-you-like-mac-n-cheese.wav</code> to the server and should produce output like:</p>
<pre><code><span class="hl-0">asrSOS</span><br/><span class="hl-0">asrResult</span><span class="hl-1"> { </span><span class="hl-2">text</span><span class="hl-1">: </span><span class="hl-8">&#39;do you like&#39;</span><span class="hl-1">, </span><span class="hl-2">confidence</span><span class="hl-1">: </span><span class="hl-4">0.5</span><span class="hl-1"> }</span><br/><span class="hl-0">asrResult</span><span class="hl-1"> { </span><span class="hl-2">text</span><span class="hl-1">: </span><span class="hl-8">&#39;do you like mac and&#39;</span><span class="hl-1">, </span><span class="hl-2">confidence</span><span class="hl-1">: </span><span class="hl-4">0.5</span><span class="hl-1"> }</span><br/><span class="hl-0">asrAudio</span><span class="hl-1"> </span><span class="hl-0">done</span><br/><span class="hl-0">asrEnd</span><span class="hl-1"> { </span><span class="hl-2">text</span><span class="hl-1">: </span><span class="hl-8">&#39;Do you like Mac and cheese?&#39;</span><span class="hl-1">, </span><span class="hl-2">confidence</span><span class="hl-1">: </span><span class="hl-4">0.96449</span><span class="hl-1"> }</span>
</code></pre>
<p>Typing <code>quit</code> terminates the cli.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Modules</a></li><li class=" tsd-kind-module"><a href="modules/asr_ASRSessionHandler.html">asr/ASRSession<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/auth.html">auth</a></li><li class=" tsd-kind-module"><a href="modules/auth_ExpressAuthFunctions.html">auth/<wbr/>Express<wbr/>Auth<wbr/>Functions</a></li><li class=" tsd-kind-module"><a href="modules/auth_MockJwtAuth.html">auth/<wbr/>Mock<wbr/>Jwt<wbr/>Auth</a></li><li class=" tsd-kind-module"><a href="modules/connection_Connection.html">connection/<wbr/>Connection</a></li><li class=" tsd-kind-module"><a href="modules/connection_ConnectionManager.html">connection/<wbr/>Connection<wbr/>Manager</a></li><li class=" tsd-kind-module"><a href="modules/connection_Subscription.html">connection/<wbr/>Subscription</a></li><li class=" tsd-kind-module"><a href="modules/errors.html">errors</a></li><li class=" tsd-kind-module"><a href="modules/handlers.html">handlers</a></li><li class=" tsd-kind-module"><a href="modules/handlers_ExampleHandlers.html">handlers/<wbr/>Example<wbr/>Handlers</a></li><li class=" tsd-kind-module"><a href="modules/handlers_HealthCheckHandler.html">handlers/<wbr/>Health<wbr/>Check<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/handlers_TimeHandler.html">handlers/<wbr/>Time<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/handlers_WsExampleHandlers.html">handlers/<wbr/>Ws<wbr/>Example<wbr/>Handlers</a></li><li class=" tsd-kind-module"><a href="modules/handlers_mockAuth_MockAuthHandlers.html">handlers/mock<wbr/>Auth/<wbr/>Mock<wbr/>Auth<wbr/>Handlers</a></li><li class=" tsd-kind-module"><a href="modules/handlers_site_SiteHandlers.html">handlers/site/<wbr/>Site<wbr/>Handlers</a></li><li class=" tsd-kind-module"><a href="modules/index.html">index</a></li><li class=" tsd-kind-module"><a href="modules/model.html">model</a></li><li class=" tsd-kind-module"><a href="modules/model_Model.html">model/<wbr/>Model</a></li><li class=" tsd-kind-module"><a href="modules/nlu_LimaClient.html">nlu/<wbr/>Lima<wbr/>Client</a></li><li class=" tsd-kind-module"><a href="modules/nlu_NluSessionHandler.html">nlu/<wbr/>Nlu<wbr/>Session<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/server.html">server</a></li><li class=" tsd-kind-module"><a href="modules/server_SocketIoControllerServer.html">server/<wbr/>Socket<wbr/>Io<wbr/>Controller<wbr/>Server</a></li><li class=" tsd-kind-module"><a href="modules/server_SocketIoDeviceServer.html">server/<wbr/>Socket<wbr/>Io<wbr/>Device<wbr/>Server</a></li><li class=" tsd-kind-module"><a href="modules/skills_AbstractSkillSessionHandler.html">skills/<wbr/>Abstract<wbr/>Skill<wbr/>Session<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/skills_ClockSkillSessionHandler.html">skills/<wbr/>Clock<wbr/>Skill<wbr/>Session<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/skills_CloudSkillSessionHandler.html">skills/<wbr/>Cloud<wbr/>Skill<wbr/>Session<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/skills_EchoSkillSessionHandler.html">skills/<wbr/>Echo<wbr/>Skill<wbr/>Session<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/skills_SkillsController.html">skills/<wbr/>Skills<wbr/>Controller</a></li><li class=" tsd-kind-module"><a href="modules/skills_SkillsManager.html">skills/<wbr/>Skills<wbr/>Manager</a></li><li class=" tsd-kind-module"><a href="modules/tts_TTSSessionHandler.html">tts/TTSSession<wbr/>Handler</a></li><li class=" tsd-kind-module"><a href="modules/types.html">types</a></li><li class=" tsd-kind-module"><a href="modules/types_auth.html">types/auth</a></li><li class=" tsd-kind-module"><a href="modules/util_ExpressRouterWrapper.html">util/<wbr/>Express<wbr/>Router<wbr/>Wrapper</a></li><li class=" tsd-kind-module"><a href="modules/util_WebSocketServerWrapper.html">util/<wbr/>Web<wbr/>Socket<wbr/>Server<wbr/>Wrapper</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li><li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li><li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>